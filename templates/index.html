<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Book Collection</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>

<body>
    <h1>My Book Collection</h1>

    <a href="{{ url_for('add_book') }}">Add a New Book</a>

    <!-- Search, Filter, and Sort Form -->
    <form method="GET" action="{{ url_for('home') }}">
        <input type="text" name="q" placeholder="Search by title, description, or tags" value="{{ search_query }}" />

        <select name="status">
            <option value="">Filter by Reading Status</option>
            <option value="to read" {% if status_filter=='to read' %}selected{% endif %}>To Read</option>
            <option value="reading" {% if status_filter=='reading' %}selected{% endif %}>Reading Right Now</option>
            <option value="read" {% if status_filter=='read' %}selected{% endif %}>Already Read</option>
        </select>

        <!-- Sorting Dropdown -->
        <select name="sort_by">
            <option value="title" {% if sort_by=='title' %}selected{% endif %}>Sort by Title</option>
            <option value="category" {% if sort_by=='category' %}selected{% endif %}>Sort by Category</option>
            <option value="status" {% if sort_by=='status' %}selected{% endif %}>Sort by Status</option>
            <option value="progress" {% if sort_by=='progress' %}selected{% endif %}>Sort by Reading Progress</option>
        </select>

        <button type="submit">Search & Sort</button>
    </form>
    <ul>
        {% for book in books %}
        <li>
            <h2><a href="{{ url_for('book_detail', id=book.id) }}">{{ book.title }}</a></h2>
            <p>{{ book.description }}</p>
            <p><strong>Category:</strong> {{ book.category }}</p>
            <p><strong>Tags:</strong> {{ book.tags }}</p>
            <p><strong>Status:</strong> {{ book.status }}</p>
            <p><strong>Progress:</strong> {{ book.pages_read }} / {{ book.pages }} pages</p>

            {% if book.pages > 0 %}
            {% set percentage = (book.pages_read / book.pages) * 100 %}
            <div class="progress">
                <div class="progress-bar" data-progress="{{ percentage|int }}" aria-valuenow="{{ percentage|int }}"
                    aria-valuemin="0" aria-valuemax="100">
                    {{ percentage|int }}%
                </div>
            </div>
            {% endif %}

            <img src="{{ book.cover_url }}" alt="Book Cover" style="width:150px;">
            <br><a href="{{ url_for('edit_book', id=book.id) }}">Edit</a>
        </li>
        {% endfor %}
    </ul>
    <script src="{{ url_for('static', filename='script.js') }}"></script>
</body>

</html>